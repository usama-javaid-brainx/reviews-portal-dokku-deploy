<h2>Photos</h2>
<div class="tabs_content_wrap" data-controller="photos">

  <div class="uploaded-files d-none" id="js-uploaded-files">
    <div class="mb-3 main-thumbnail">
      <img id="mainThumbnail" data-photos-target="mainThumbnail" src="https://cdn.filestackcontent.com/5gHkNOKTru4JPI3Ey1VP">
    </div>
    <div class="d-flex" id="js-thumbnails">
      <%= f.filestack_field :images_input, '+', class: 'thumbnail upload-button px-0', id: 'unique-iddd', input_id: 'unique-input-idsd', pickerOptions: { onFileUploadFinished: 'callbackOnFileUploadFinished' } %>
    </div>
  </div>
<% debugger %>
  <% if f.object.persisted? %>
    <div class="uploaded-files" id="js-uploaded-files">
      <div class="mb-3 main-thumbnail">
        <img id="mainThumbnail" data-photos-target="mainThumbnail" src=<%= f.object.images.first %>>
      </div>
      <div class="d-flex" id="js-thumbnails">
        <%= f.object.images[1..].each do %>
          <img class="thumbnail px-0" src=<%= f.object.images %>>
        <% end %> %>
        <button name="button" type="button" class="thumbnail upload-button px-0" id="unique-iddd" input_id="unique-input-idsd" onclick="(function(){
          filestack_client.picker({ onUploadDone: data => (function(data){const filestack_input_field= document.getElementById('unique-input-idsd');filestack_input_field.value = data.filesUploaded.map(e => e.url);})(data), onFileUploadFinished: data => callbackOnFileUploadFinished(data),  }).open()})()">+
        </button>
        <input id="unique-input-idsd" style="display:none" type="text" name="review[images_input]">
      </div>
    </div>
  <% end %>

  <div class="file_upload_place" id="file_upload_place">
    <div class="content">
      <div class="upload_link">
        <%= f.filestack_field :images_input, 'Upload files', id: 'unique-iddd', input_id: 'unique-input-idsd', pickerOptions: { onFileUploadFinished: 'callbackOnFileUploadFinished', accept: ["image/*"], maxFiles: 10 } %>
        <div>PNG, JGP (max 10MB)</div>
      </div>
    </div>
  </div>
  <div id="image_inputs">

  </div>
</div>

<script>
  function callbackOnFileUploadFinished(data) {
    const image = document.createElement('img');
    image.classList.add('thumbnail', 'px-0')
    image.setAttribute(
      'src',
      data.url
    );
    image.addEventListener("click", () => {
      updateImage(image)
    })
    document.getElementById('js-thumbnails').prepend(image)
    const input = document.createElement('input')
    input.value = data.url
    input.hidden = true
    input.name = 'review[images][]'
    document.getElementById('image_inputs').append(input)
    updateImage(image)
    document.getElementById('js-uploaded-files').classList.remove('d-none')
    document.getElementById('file_upload_place').classList.add('d-none')
  }

  function updateImage(that) {
    document.getElementById('mainThumbnail').src = that.src
  }
</script>