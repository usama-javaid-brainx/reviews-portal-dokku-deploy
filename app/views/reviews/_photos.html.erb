<h2>Photos</h2>
<div class="tabs_content_wrap" data-controller="photos">

  <% if !f.object.images? %>
    <div class="file_upload_place" id="file_upload_place">
      <div class="content">
        <div class="upload_link">
          <%= f.filestack_field :images_input, 'Upload files', id: 'unique-iddd', input_id: 'unique-input-idsd', pickerOptions: { accept: ["image/*"], onFileUploadFinished: 'callbackOnFileUploadFinished', maxFiles: 10 } %>
          <div>PNG, JGP (max 10MB)</div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="uploaded-files <%= "d-none" if !f.object.images? %>" id="js-uploaded-files">
    <div class="mb-3 main-thumbnail">
      <img id="mainThumbnail" data-photos-target="mainImage" src=<%= f.object.images.first if f.object.images? %>>
    </div>
    <div class="d-flex position-relative" id="js-thumbnails" data-controller="sortable-images">
      <% if f.object.images? %>
        <% f.object.images.each do |image_src| %>
          <img class="thumbnail px-0" data-action="click->photos#clickImage" src=<%= image_src %>>
          <div data-action="click->photos#deleteImage" class="delete"> <%= image_tag("template/image-delete.svg") %></div>
          <input type="hidden" class="image-inputs" name="review[images][]" value=<%= image_src %>>
        <% end %>
      <% end %>
      <%= f.filestack_field :images_input, '+', class: 'thumbnail upload-button px-0', id: 'unique-iddd', input_id: 'unique-input-idsd', pickerOptions: { accept: ["image/*"], onFileUploadFinished: 'callbackOnFileUploadFinished', maxFiles: 10 } %>
    </div>
  </div>
</div>

<script>
  function callbackOnFileUploadFinished(data) {
    const image = document.createElement('img');
    image.classList.add('thumbnail', 'px-0')
    image.setAttribute(
      'src', data.url
    );
    image.setAttribute(
      "data-action", "click->photos#clickImage"
    );
    document.getElementById('js-thumbnails').prepend(image)
    const input = document.createElement('input')
    input.type = "hidden"
    input.classList.add("image-inputs")
    input.name = 'review[images][]'
    input.value = data.url
    document.getElementById('js-thumbnails').prepend(input)
    updateImage(image)
    document.getElementById('js-uploaded-files').classList.remove('d-none')
    document.getElementById('file_upload_place').classList.add('d-none')
  }

  function updateImage(that) {
    document.getElementById('mainThumbnail').src = that.src
  }
</script>